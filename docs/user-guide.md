# OpenWAM Webアプリケーション ユーザーガイド

## 概要

OpenWAM Webアプリケーションは、エンジンシミュレーションを直感的なWebインターフェースで実行できるツールです。ドラッグ&ドロップによるビジュアルモデリング、リアルタイムシミュレーション実行、インタラクティブな結果可視化を提供します。

## 目次

1. [はじめに](#はじめに)
2. [プロジェクト管理](#プロジェクト管理)
3. [ビジュアルモデルエディター](#ビジュアルモデルエディター)
4. [シミュレーション実行](#シミュレーション実行)
5. [結果の可視化と分析](#結果の可視化と分析)
6. [ファイル管理](#ファイル管理)
7. [設定とカスタマイズ](#設定とカスタマイズ)

## はじめに

### システム要件

#### 必須要件

- **Node.js**: バージョン18以上
- **npm**: Node.jsに付属（またはyarn）
- **ブラウザ**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **OS**: Windows 10+, macOS 10.15+, Ubuntu 18.04+

#### 推奨要件

- **画面解像度**: 1280x720以上（1920x1080推奨）
- **メモリ**: 4GB以上（8GB推奨）
- **ストレージ**: 1GB以上の空き容量
- **CPU**: デュアルコア以上（クアッドコア推奨）

#### OpenWAM実行ファイル

- **OpenWAM実行ファイル**: シミュレーション実行に必要
- **対応バージョン**: OpenWAM 2200以上
- **配置場所**: プロジェクトルートまたは環境変数で指定

### インストールと初期設定

#### 1. Node.jsのインストール

**Windows**:

1. [Node.js公式サイト](https://nodejs.org/)からLTSバージョンをダウンロード
2. インストーラーを実行し、指示に従ってインストール
3. コマンドプロンプトで確認:

   ```cmd
   node --version
   npm --version
   ```

**macOS**:

1. Homebrewを使用する場合:

   ```bash
   brew install node
   ```

2. または公式サイトからインストーラーをダウンロード
3. ターミナルで確認:

   ```bash
   node --version
   npm --version
   ```

**Linux (Ubuntu/Debian)**:

```bash
# NodeSourceリポジトリを追加
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -

# Node.jsをインストール
sudo apt-get install -y nodejs

# バージョン確認
node --version
npm --version
```

#### 2. アプリケーションのダウンロードと設定

**リポジトリのクローン**:

```bash
git clone <repository-url>
cd openwam-webapp
```

**依存関係のインストール**:

```bash
# ルートディレクトリで実行
npm install

# クライアント側の依存関係もインストール
cd client
npm install
cd ..
```

**環境設定ファイルの作成**:

```bash
# 環境設定ファイルをコピー
cp .env.example .env
```

**環境設定の編集**:
`.env`ファイルを編集して、環境に合わせて設定を調整:

```bash
# サーバー設定
PORT=5000                    # サーバーポート番号
NODE_ENV=development         # 環境（development/production）
LOG_LEVEL=info              # ログレベル

# クライアント設定
CLIENT_URL=http://localhost:3000  # フロントエンドURL

# データベース設定
DATABASE_PATH=./app_data/openwam.db  # データベースファイルパス

# ファイルアップロード設定
UPLOAD_DIR=./uploads         # アップロードディレクトリ
MAX_FILE_SIZE=52428800      # 最大ファイルサイズ（50MB）

# OpenWAM設定
OPENWAM_EXECUTABLE_PATH=./OpenWAM    # OpenWAM実行ファイルパス
OPENWAM_TIMEOUT=300000      # タイムアウト時間（5分）

# セキュリティ設定
SESSION_SECRET=your-secret-key-here  # セッション暗号化キー
```

#### 3. OpenWAM実行ファイルの配置

**Windows**:

1. OpenWAM実行ファイル（`OpenWAM.exe`）をプロジェクトルートに配置
2. または環境変数`OPENWAM_EXECUTABLE_PATH`で指定:

   ```
   OPENWAM_EXECUTABLE_PATH=C:\path\to\OpenWAM.exe
   ```

**Linux/macOS**:

1. OpenWAM実行ファイルをプロジェクトルートに配置
2. 実行権限を付与:

   ```bash
   chmod +x OpenWAM
   ```

3. または環境変数で指定:

   ```
   OPENWAM_EXECUTABLE_PATH=/path/to/OpenWAM
   ```

### アプリケーションの起動

#### 開発モード（推奨）

**統合起動コマンド**:

```bash
# プロジェクトルートで実行
npm run dev
```

このコマンドは以下を同時に起動します:

- バックエンドサーバー（ポート5000）
- フロントエンド開発サーバー（ポート3000）

**個別起動**:

```bash
# ターミナル1: バックエンドサーバー
npm run server:dev

# ターミナル2: フロントエンドサーバー
npm run client:dev
```

#### 本番モード

**ビルドと起動**:

```bash
# アプリケーションをビルド
npm run build

# 本番サーバーを起動
npm start
```

### 初回アクセス

#### 1. ブラウザでアクセス

開発モードの場合:

- フロントエンド: `http://localhost:3000`
- バックエンドAPI: `http://localhost:5000`

本番モードの場合:

- アプリケーション: `http://localhost:5000`

#### 2. 起動確認

**正常起動時の表示**:

```
[INFO] Server starting...
[INFO] Database initialized
[INFO] Server running on port 5000
[INFO] Client development server running on port 3000
```

**ブラウザでの確認**:

1. `http://localhost:3000`にアクセス
2. OpenWAM Webアプリケーションのメインダッシュボードが表示される
3. 「新規プロジェクト」ボタンが表示されることを確認

#### 3. システム状態の確認

**ヘルスチェック**:
ブラウザで`http://localhost:5000/api/system/health`にアクセスして、システムの状態を確認:

```json
{
  "status": "healthy",
  "checks": {
    "database": "ok",
    "filesystem": "ok",
    "openwam": "ok"
  }
}
```

### 起動時のトラブルシューティング

#### よくある問題と解決方法

**1. ポートが使用中のエラー**

```
Error: Port 3000 is already in use
```

**解決方法**:

- 他のアプリケーションを終了
- または`.env`ファイルでポート番号を変更

**2. Node.jsバージョンエラー**

```
Error: Node.js version 18 or higher is required
```

**解決方法**:

- Node.jsを最新のLTSバージョンに更新

**3. 依存関係のエラー**

```
Error: Cannot find module 'express'
```

**解決方法**:

```bash
# 依存関係を再インストール
rm -rf node_modules package-lock.json
npm install
```

**4. OpenWAM実行ファイルが見つからない**

```
Error: OpenWAM executable not found
```

**解決方法**:

- OpenWAM実行ファイルのパスを確認
- `.env`ファイルの`OPENWAM_EXECUTABLE_PATH`を正しく設定

**5. データベース初期化エラー**

```
Error: Database initialization failed
```

**解決方法**:

```bash
# データベースディレクトリを作成
mkdir -p app_data
# 権限を確認
chmod 755 app_data
```

### 初期設定の完了確認

以下の項目を確認して、初期設定が正しく完了していることを確認してください:

- [ ] Node.js 18以上がインストールされている
- [ ] 依存関係がすべてインストールされている
- [ ] `.env`ファイルが正しく設定されている
- [ ] OpenWAM実行ファイルが配置されている
- [ ] アプリケーションが正常に起動する
- [ ] ブラウザでアクセスできる
- [ ] メインダッシュボードが表示される
- [ ] システムヘルスチェックが成功する

### 次のステップ

初期設定が完了したら、以下の手順でアプリケーションの使用を開始できます:

1. **[プロジェクト管理](#プロジェクト管理)**: 新規プロジェクトの作成方法
2. **[ビジュアルモデルエディター](#ビジュアルモデルエディター)**: モデル作成の基本操作
3. **[シミュレーション実行](#シミュレーション実行)**: 初回シミュレーションの実行

## プロジェクト管理

### 新規プロジェクトの作成

1. **「新規プロジェクト」ボタンをクリック**
   - メインダッシュボードの「新規プロジェクト」ボタンを押します

2. **プロジェクト情報を入力**
   - プロジェクト名: わかりやすい名前を入力
   - 説明: プロジェクトの目的や内容を記述（任意）

3. **プロジェクトを作成**
   - 「作成」ボタンを押してプロジェクトを作成します
   - 自動的にモデルエディターが開きます

### 既存プロジェクトを開く

1. **プロジェクト一覧から選択**
   - メインダッシュボードのプロジェクト一覧から目的のプロジェクトをクリック

2. **最近のプロジェクト**
   - 最近使用したプロジェクトは上部に表示されます

### プロジェクトの管理

- **名前変更**: プロジェクト設定から名前と説明を変更できます
- **複製**: 既存プロジェクトをベースに新しいプロジェクトを作成
- **削除**: 不要なプロジェクトを削除（復元不可能）
- **エクスポート**: プロジェクト全体をファイルとして保存

## ビジュアルモデルエディター

### 基本操作

#### キャンバスの操作

- **パン（移動）**: マウスドラッグでキャンバスを移動
- **ズーム**: マウスホイールまたはズームボタンで拡大縮小
- **グリッド表示**: グリッドボタンでグリッドの表示/非表示を切り替え

#### コンポーネントの配置

1. **コンポーネントパレットから選択**
   - 左側のパレットからコンポーネントカテゴリを展開
   - 使用したいコンポーネントをクリック

2. **キャンバスに配置**
   - キャンバス上の任意の位置をクリックしてコンポーネントを配置

3. **コンポーネントの移動**
   - 配置済みコンポーネントをドラッグして移動

### コンポーネントの種類

#### パイプ（1DPipes）

- **1Dパイプ (TTubo)**: 基本的な1次元パイプ要素
- **同心円パイプ (TConcentrico)**: 二重管構造のパイプ

#### 境界条件（Boundaries）

- **開放端（大気）**: 大気圧への開放端
- **閉端**: 完全に閉じられた端部
- **無反射端**: 反射のない端部条件
- **パルス端**: 圧力パルス入力
- **噴射端**: 燃料噴射端
- **圧力損失**: 線形・二次圧力損失

#### プレナム（0Dモデル）

- **定容積プレナム**: 一定容積のチャンバー
- **可変容積プレナム**: 容積が変化するチャンバー
- **シンプルタービン**: 基本的なタービンモデル
- **ツインタービン**: 二段タービンモデル

#### バルブ（Connections）

- **固定CD**: 固定流量係数バルブ
- **4Tバルブ**: 4ストロークエンジンバルブ
- **リードバルブ**: 一方向リードバルブ
- **回転ディスク**: 回転式バルブ

### コンポーネントの接続

1. **接続ツールを選択**
   - ツールバーの接続ツールをクリック

2. **接続点をクリック**
   - 接続したいコンポーネントの接続点を順番にクリック
   - 有効な接続は緑色、無効な接続は赤色で表示

3. **接続の確認**
   - 接続線が表示され、接続が完了します

### プロパティの編集

1. **コンポーネントを選択**
   - 編集したいコンポーネントをクリック

2. **プロパティパネルで編集**
   - 右側のプロパティパネルで各種パラメータを編集
   - リアルタイムでバリデーションが実行されます

3. **主要なプロパティ**

#### パイプのプロパティ

- **パイプ番号**: OpenWAM内でのパイプ識別番号
- **ノード番号**: 左端・右端のノード番号
- **計算セル数**: 数値計算の分割数
- **長さ**: パイプの全長 [m]
- **直径**: パイプの内径 [m]
- **摩擦係数**: 壁面摩擦係数
- **壁面材料**: 密度、比熱、熱伝導率

#### 境界条件のプロパティ

- **境界条件タイプ**: 境界条件の種類
- **圧力**: 境界圧力 [Pa]
- **温度**: 境界温度 [K]
- **流量係数**: 流量特性パラメータ

## シミュレーション実行

### シミュレーション設定

1. **シミュレーションボタンをクリック**
   - ツールバーの「シミュレーション実行」ボタンを押します

2. **計算条件を設定**
   - **角度増分**: 計算の時間刻み [度]
   - **シミュレーション時間**: 計算する時間範囲 [秒]
   - **環境条件**: 大気圧、大気温度
   - **収束判定**: 収束判定基準

3. **詳細設定（オプション）**
   - **並列計算**: OpenMP並列化の有効/無効
   - **出力間隔**: 結果出力の時間間隔
   - **タイムアウト**: 最大計算時間

### シミュレーション実行

1. **モデル検証**
   - 実行前に自動的にモデルが検証されます
   - エラーがある場合は修正が必要です

2. **実行開始**
   - 「実行開始」ボタンでシミュレーションを開始

3. **進行状況の監視**
   - リアルタイムで進行状況が表示されます
   - 推定残り時間も表示されます

4. **実行制御**
   - **一時停止**: 計算を一時停止
   - **キャンセル**: 計算を中止
   - **ログ表示**: 詳細なログを確認

### エラーハンドリング

#### よくあるエラーと対処法

- **収束エラー**: 時間刻みを小さくする、初期条件を調整
- **メモリ不足**: 計算セル数を減らす、モデルを簡略化
- **ファイルエラー**: ファイルパスと権限を確認

## 結果の可視化と分析

### 結果ビューア

シミュレーション完了後、自動的に結果ビューアが開きます。

#### チャートの種類

1. **圧力分布**
   - 各ノードの圧力変化をプロット
   - 時系列データとして表示

2. **温度分布**
   - 各ノードの温度変化
   - カラーマップ表示も可能

3. **速度分布**
   - パイプ内の流速変化
   - ベクトル表示対応

4. **流量特性**
   - 質量流量の時間変化
   - 各境界での流入出量

#### インタラクティブ機能

- **ズーム・パン**: マウス操作でチャートを拡大・移動
- **データポイント検査**: 特定点の詳細値を表示
- **時間範囲選択**: 特定時間範囲のデータを抽出
- **データフィルタリング**: 表示するデータ系列を選択

### 統計情報

- **最大・最小・平均値**: 各物理量の統計値
- **性能指標**: エンジン性能に関する指標
- **効率計算**: 熱効率、体積効率など

### 結果の比較

1. **比較モードを選択**
   - 複数のシミュレーション結果を同時表示

2. **比較対象を選択**
   - 過去のシミュレーション結果から選択

3. **差分表示**
   - 結果の差分をハイライト表示

## ファイル管理

### ファイルのアップロード

1. **ファイルアップロードボタンをクリック**
   - プロジェクト画面の「ファイルアップロード」ボタン

2. **ファイルを選択**
   - 対応形式: .wam, .csv, .dat
   - 最大ファイルサイズ: 10MB

3. **アップロード実行**
   - ファイルが検証され、プロジェクトに追加されます

### WAMファイルのインポート

1. **WAMファイルをアップロード**
   - 既存のOpenWAM入力ファイルをアップロード

2. **インポートオプション**
   - **モデルとしてインポート**: ビジュアルモデルに変換
   - **ファイルのみ保存**: ファイルとして保存のみ

3. **自動配置**
   - インポートされたコンポーネントは自動的に配置されます

### ファイルのエクスポート

#### モデルのエクスポート

1. **エクスポート形式を選択**
   - WAM形式: OpenWAM標準形式
   - JSON形式: ビジュアルモデル形式
   - CSV形式: パラメータ一覧

2. **エクスポート実行**
   - ファイルがダウンロードされます

#### 結果のエクスポート

1. **結果ビューアからエクスポート**
   - CSV形式: 数値データ
   - PNG/SVG形式: チャート画像
   - PDF形式: レポート形式

## 設定とカスタマイズ

### アプリケーション設定

#### 表示設定

- **言語**: 日本語/英語の切り替え
- **テーマ**: ライト/ダークテーマ
- **グリッド**: デフォルトグリッド設定
- **単位系**: SI単位/工学単位の選択

#### 計算設定

- **デフォルト計算条件**: 新規シミュレーションの初期値
- **並列計算**: OpenMP設定
- **メモリ制限**: 最大使用メモリ
- **タイムアウト**: デフォルトタイムアウト時間

#### ファイル設定

- **自動保存**: 自動保存間隔の設定
- **バックアップ**: バックアップファイルの保持数
- **一時ファイル**: 一時ファイルの保存場所

### キーボードショートカット

#### 一般操作

- `Ctrl+N`: 新規プロジェクト
- `Ctrl+O`: プロジェクトを開く
- `Ctrl+S`: プロジェクトを保存
- `Ctrl+Z`: 元に戻す
- `Ctrl+Y`: やり直し

#### エディター操作

- `Delete`: 選択コンポーネントを削除
- `Ctrl+A`: 全選択
- `Ctrl+C`: コピー
- `Ctrl+V`: 貼り付け
- `Space`: パンモード切り替え

#### シミュレーション

- `F5`: シミュレーション実行
- `Esc`: シミュレーション停止

### カスタムコンポーネント

#### コンポーネントテンプレートの作成

1. **基本コンポーネントを配置・設定**
2. **テンプレートとして保存**
3. **名前と説明を設定**
4. **カテゴリを選択**

#### テンプレートの使用

1. **コンポーネントパレットの「カスタム」タブ**
2. **保存済みテンプレートを選択**
3. **通常のコンポーネントと同様に配置**

## トラブルシューティング

一般的な問題と解決方法については、[トラブルシューティングガイド](troubleshooting-guide.md)を参照してください。

## サポート

- **ドキュメント**: [OpenWAMコンポーネントリファレンス](component-reference.md)
- **FAQ**: よくある質問と回答
- **コミュニティ**: ユーザーフォーラム
- **バグレポート**: GitHub Issues

---

このガイドは OpenWAM Webアプリケーション v1.0 に基づいています。
最新の情報については、アプリケーション内のヘルプまたは公式ドキュメントを参照してください。
