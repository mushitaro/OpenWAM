# BMW E46 M3 VANOSシミュレータ データソース説明書

## 概要

BMW E46 M3 VANOSシミュレータで使用しているVANOSテーブルデータの正確な定義と意味について説明します。

## VANOSテーブルデータの正体

### 1. データの性質

現在シミュレータで使用している「VANOSテーブル」の値は：

- **実測データではない**
- **BMW S54エンジンのDME（Digital Motor Electronics）制御パラメータ**
- **工場出荷時の標準制御マップ**

### 2. DME制御パラメータとは

```
DME制御パラメータ = エンジンコントロールユニットが使用する制御値
```

**特徴**:
- BMW純正ECUの制御ロジック
- RPM × TPS（スロットル開度）の2次元マップ
- 最適化された制御戦略
- 排ガス規制・燃費・性能のバランス

### 3. データの構造

#### 3.1 インテークVANOS制御マップ

```python
'intake': {
    'rpm_points': [600, 900, 1100, 1400, 1600, 1800, 2200, 2700, 2900, 3100, 4000, 5000, 5800, 6800, 7000, 7800],
    'load_points': [0.15, 0.40, 0.80, 1.20, 1.60, 2.40, 4.80, 7.60, 11.00, 15.00, 20.00, 25.00, 30.00, 45.00, 65.00, 85.00],
    'advance_map': [
        # 16×16のマップ（RPM × TPS）
        # 値の範囲: 70°～130° ATDC
    ]
}
```

**意味**:
- `rpm_points`: DMEが制御判定を行うRPMポイント
- `load_points`: TPS（スロットル開度）% - エンジン負荷の指標
- `advance_map`: 各運転条件でのインテークVANOS進角値

#### 3.2 エキゾーストVANOS制御マップ

```python
'exhaust': {
    'rpm_points': [900, 1300, 2100, 2400, 2700, 2900, 3000, 3100, 3800, 4500, 5400, 6200, 6400, 7200, 7400, 7800],
    'load_points': [0.15, 0.40, 0.80, 1.20, 1.60, 2.40, 4.80, 7.60, 11.00, 15.00, 20.00, 25.00, 30.00, 45.00, 65.00, 85.00],
    'retard_map': [
        # 16×16のマップ（RPM × TPS）
        # 値の範囲: 52°～97° ABDC
    ]
}
```

**意味**:
- エキゾースト専用のRPMポイント（インテークと異なる）
- `retard_map`: 各運転条件でのエキゾーストVANOS遅角値

## 4. DME制御の考え方

### 4.1 制御戦略

BMW S54エンジンのDME制御戦略：

```
低RPM域:
- インテーク: 遅角（110°-130°）→ 低速トルク重視
- エキゾースト: 遅角（80°-97°）→ 排気ガス掃気改善

中RPM域:
- インテーク: 中間（90°-110°）→ バランス重視
- エキゾースト: 中間（75°-85°）→ 効率とパワーのバランス

高RPM域:
- インテーク: 進角（70°-90°）→ 高回転パワー重視
- エキゾースト: 進角（52°-75°）→ 排気効率最大化
```

### 4.2 TPS（スロットル開度）による制御

```
低TPS（部分負荷）:
- 燃費重視の制御
- 排ガス規制対応
- 安定性重視

高TPS（全負荷）:
- パワー重視の制御
- 最大性能発揮
- レスポンス重視
```

## 5. シミュレータでの使用方法

### 5.1 制御値の解釈

```python
def interpolate_vanos_angle(rpm, tps, vanos_config):
    """
    DME制御パラメータから現在の運転条件でのVANOS角度を取得
    
    Parameters:
    - rpm: エンジン回転数
    - tps: スロットル開度（%）- DME制御の負荷指標
    - vanos_config: DME制御マップ
    
    Returns:
    - VANOS角度（DME制御値）
    """
```

### 5.2 物理的意味

取得したVANOS角度は：

1. **インテーク**: バルブ最大リフト角度（ATDC基準）
2. **エキゾースト**: バルブ最大リフト角度（ABDC基準）
3. **制御精度**: DMEの実際の制御分解能
4. **最適化**: BMW純正の最適化済み値

## 6. 実測データとの違い

### 6.1 DME制御パラメータ（現在使用）

- **性質**: 制御目標値
- **最適化**: BMW純正の最適化済み
- **用途**: エンジン制御
- **精度**: 制御用途に最適化

### 6.2 実測データ（もし使用する場合）

- **性質**: 実際の測定値
- **変動**: 個体差・環境差あり
- **用途**: 検証・キャリブレーション
- **精度**: 測定精度に依存

## 7. シミュレータの妥当性

### 7.1 制御パラメータ使用の利点

1. **一貫性**: BMW純正の制御ロジック
2. **最適化**: 工場での最適化済み
3. **再現性**: 同じ条件で同じ結果
4. **信頼性**: BMW公式の制御戦略

### 7.2 制限事項

1. **理想値**: 実際の機械的誤差は含まない
2. **標準仕様**: 個体差は反映されない
3. **制御目標**: 実際の達成値とは異なる可能性

## 8. 今後の改良可能性

### 8.1 実測データとの比較

```python
# 将来的な拡張例
def compare_dme_vs_actual(dme_angle, measured_angle):
    """
    DME制御値と実測値の比較
    """
    deviation = abs(dme_angle - measured_angle)
    if deviation > 5.0:  # 5°以上の差
        print(f"Large deviation detected: DME={dme_angle}°, Actual={measured_angle}°")
    
    return {
        'dme_target': dme_angle,
        'actual_measured': measured_angle,
        'deviation': deviation
    }
```

### 8.2 個体差の考慮

```python
# 個体差を考慮した制御値
def apply_individual_variation(base_dme_angle, variation_factor=1.0):
    """
    個体差を考慮したVANOS角度
    """
    return base_dme_angle * variation_factor
```

## 9. まとめ

現在のVANOSシミュレータは：

- **BMW S54エンジンのDME制御パラメータ**を使用
- **純正制御ロジック**を忠実に再現
- **標準的な制御戦略**をシミュレート
- **実測データではない**が、**制御の意図**を正確に反映

この理解により、シミュレータの結果は「BMW純正DMEがどのような制御を行うか」を示すものであり、実際のエンジンの物理的挙動とは区別して解釈する必要があります。

---

**作成日**: 2024年
**バージョン**: 1.0
**対象**: BMW S54 (E46 M3) DME制御パラメータ
**データソース**: BMW純正DME制御マップ